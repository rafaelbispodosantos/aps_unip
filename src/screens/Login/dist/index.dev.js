"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=Login;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _native=require("@react-navigation/native");var _expoCamera=require("expo-camera");var _axios=_interopRequireDefault(require("axios"));var _common=require("../../common");var _base=require("base-64");var _NoPermissionGranted=_interopRequireDefault(require("../NoPermissionGranted"));var _styles=_interopRequireDefault(require("./styles"));var _jsxFileName="/home/marllon/Documentos/GitGithub/aps_unip/src/screens/Login/index.js";function Login(_ref){var navigation=_ref.navigation;var camRef=(0,_react.useRef)(null);var _useState=(0,_react.useState)(false),_useState2=(0,_slicedToArray2["default"])(_useState,2),openModal=_useState2[0],setOpenModal=_useState2[1];var _useState3=(0,_react.useState)(null),_useState4=(0,_slicedToArray2["default"])(_useState3,2),permission=_useState4[0],setPermission=_useState4[1];var _useState5=(0,_react.useState)(null),_useState6=(0,_slicedToArray2["default"])(_useState5,2),picture=_useState6[0],setPicture=_useState6[1];var _useState7=(0,_react.useState)(_expoCamera.Camera.Constants.Type.front),_useState8=(0,_slicedToArray2["default"])(_useState7,2),type=_useState8[0],setType=_useState8[1];var focused=(0,_native.useIsFocused)();var requestCameraPermission=function requestCameraPermission(){var _ref2,status;return _regenerator["default"].async(function requestCameraPermission$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator["default"].awrap(_expoCamera.Camera.requestPermissionsAsync());case 2:_ref2=_context.sent;status=_ref2.status;setPermission(status==='granted');case 5:case"end":return _context.stop();}}});};var signin=function signin(){var base64=picture.base64;console.log(base64);var photoConvertedFormData=convertBase64(base64);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=photoConvertedFormData.entries()[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var i=_step.value;console.log(i[0],i[1]);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]();}}finally{if(_didIteratorError){throw _iteratorError;}}}};(0,_react.useEffect)(function(){requestCameraPermission();},[]);function convertBase64(base64){var formData=new FormData();var imagem=(0,_base.decode)(base64);var convertImagem=new Array(imagem.length);for(var i=0;i<convertImagem.length;i++){convertImagem[i]=imagem.charCodeAt(i);}imagem=new Uint8Array(convertImagem);imagem=new Blob([imagem],{type:'image/png'});imagem=new File([imagem],"imagemUsuario.png",{type:"image/png"});formData.append('imagemUsuario',imagem);var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=formData[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _i=_step2.value;console.log(_i[0],_i[1]);}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}return formData;}function takePhoto(){var options,photo;return _regenerator["default"].async(function takePhoto$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!camRef){_context2.next=7;break;}options={quality:1,base64:true,skipProcessing:false};_context2.next=4;return _regenerator["default"].awrap(camRef.current.takePictureAsync(options));case 4:photo=_context2.sent;setPicture(photo);setOpenModal(true);case 7:case"end":return _context2.stop();}}});}return _react["default"].createElement(_reactNative.View,{style:_styles["default"].container,__self:this,__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:5}},_react["default"].createElement(_reactNative.View,{style:_styles["default"].containerTituloApp,__self:this,__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:7}},_react["default"].createElement(_reactNative.Text,{style:_styles["default"].tituloApp,__self:this,__source:{fileName:_jsxFileName,lineNumber:78,columnNumber:9}}," Fa\xE7a login no novo reconhecimento facial")),focused?_react["default"].createElement(_expoCamera.Camera,{style:_styles["default"].imageShow,type:type,ref:camRef,__self:this,__source:{fileName:_jsxFileName,lineNumber:80,columnNumber:18}}):_react["default"].createElement(_reactNative.Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:80,columnNumber:81}},"Teste"),openModal&&_react["default"].createElement(_reactNative.Modal,{animationType:"slide",transparent:true,visible:openModal,style:{height:'70%'},__self:this,__source:{fileName:_jsxFileName,lineNumber:81,columnNumber:21}},_react["default"].createElement(_reactNative.View,{style:_styles["default"].modalView,__self:this,__source:{fileName:_jsxFileName,lineNumber:87,columnNumber:9}},_react["default"].createElement(_reactNative.Image,{style:_styles["default"].modalImage,source:{uri:picture.uri},__self:this,__source:{fileName:_jsxFileName,lineNumber:88,columnNumber:11}}),_react["default"].createElement(_reactNative.TouchableOpacity,{style:[_styles["default"].button,{width:'90%',position:'absolute',bottom:'7%'}],onPress:function onPress(){setOpenModal(false);},__self:this,__source:{fileName:_jsxFileName,lineNumber:90,columnNumber:11}},_react["default"].createElement(_reactNative.Text,{style:_styles["default"].btnTextStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:91,columnNumber:13}},"Tirar outra foto")),_react["default"].createElement(_reactNative.TouchableOpacity,{style:[_styles["default"].button,{width:'90%',position:"absolute",bottom:'15%'}],onPress:signin,__self:this,__source:{fileName:_jsxFileName,lineNumber:94,columnNumber:11}},_react["default"].createElement(_reactNative.Text,{style:_styles["default"].btnTextStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:95,columnNumber:13}},"FAZER LOGIN ")))),_react["default"].createElement(_reactNative.TouchableOpacity,{style:[_styles["default"].button,{marginTop:20}],onPress:takePhoto,__self:this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:7}},_react["default"].createElement(_reactNative.Text,{style:_styles["default"].btnTextStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:103,columnNumber:9}},"Tirar Foto")));}